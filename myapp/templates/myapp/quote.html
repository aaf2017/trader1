<html>
<head>
<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
</head>
<body>

{% extends 'myapp/base.html' %}

{% block content %}

<h3>STOCK QUOTE CALCULATOR</h3>

<form action="/quote" method="POST">
    {% csrf_token %}
    <table>
    {{quoteForm.as_table}}
    <tr><td colspan="2"><button type="submit">Add</button></td></tr>
    </table>
</form>


<div><a href="{% url 'portfolio' %}">Back To Portfolio</a></div>
<script>
    function getCookie(c_name)
    {
        if (document.cookie.length > 0)
        {
            c_start = document.cookie.indexOf(c_name + "=");
            if (c_start != -1)
            {
                c_start = c_start + c_name.length + 1;
                c_end = document.cookie.indexOf(";", c_start);
                if (c_end == -1) c_end = document.cookie.length;
                return unescape(document.cookie.substring(c_start,c_end));
            }
        }
        return "";
    }

$(document).ready( () => {
  console.log('ready');
  $("#stock_name").focusout( ()=>{
      name = $("#stock_name").val();
      var url = "/getPrice/" + name
      $.ajaxSetup({
      headers: { "X-CSRFToken": getCookie("csrftoken") }
    }); 
    $.ajax( {
          type: 'POST',
          url: url,
          success: function( data) {
              console.log( 'data='+JSON.stringify(data))
              $("#price").val( data.price)
          },
          error: function( data) {
              console.log('ajax failed')
          }
      })
  })
});

</script>

{% endblock %}
</body>
</html>